#!/bin/bash

# ==============================================================================
# ZERO-TO-HERO: Ubuntu Logo Remover
# Description: Replaces the Plymouth/GDM Ubuntu logo with a transparent 1x1 pixel.
#              Includes automatic backup and restore functionality.
# Author:      Gemini
# ==============================================================================

# --- Configuration ---
TARGET_FILE="/usr/share/plymouth/ubuntu-logo.png"
BACKUP_FILE="${TARGET_FILE}.bak"

# Base64 string for a 1x1 transparent PNG
TRANSPARENT_PNG_B64="iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="

# --- Colors for Output ---
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# --- Helper Functions ---
log_info() { echo -e "${GREEN}[INFO]${NC} $1"; }
log_warn() { echo -e "${YELLOW}[WARN]${NC} $1"; }
log_error() { echo -e "${RED}[ERROR]${NC} $1"; }

check_root() {
 if [ "$EUID" -ne 0 ]; then
  log_error "Please run as root (use sudo)."
  exit 1
 fi
}

restore_logo() {
 log_info "Restoring original logo..."
 if [ -f "$BACKUP_FILE" ]; then
  cp "$BACKUP_FILE" "$TARGET_FILE"
  log_info "Original logo restored from backup."
  update_ramfs
 else
  log_error "No backup file found at $BACKUP_FILE. Cannot restore."
  exit 1
 fi
}

update_ramfs() {
 log_info "Updating initramfs (this may take a moment)..."
 update-initramfs -u
 if [ $? -eq 0 ]; then
  log_info "Success! Reboot your system to see changes."
 else
  log_error "Failed to update initramfs."
  exit 1
 fi
}

apply_patch() {
 # 1. Validation
 if [ ! -f "$TARGET_FILE" ]; then
  log_error "Target file not found: $TARGET_FILE"
  log_error "Your version of Ubuntu might store the logo elsewhere."
  exit 1
 fi

 # 2. Backup
 if [ ! -f "$BACKUP_FILE" ]; then
  log_info "Creating backup of original logo..."
  cp "$TARGET_FILE" "$BACKUP_FILE"
 else
  log_warn "Backup already exists. Skipping backup to preserve original."
 fi

 # 3. Create Transparent PNG
 log_info "Generating transparent replacement logo..."
 echo "$TRANSPARENT_PNG_B64" | base64 --decode >/tmp/transparent_logo_temp.png

 # 4. Replace
 log_info "Overwriting current logo..."
 mv /tmp/transparent_logo_temp.png "$TARGET_FILE"

 # 5. Update System
 update_ramfs
}

# --- Main Execution ---
check_root

if [ "$1" == "--restore" ]; then
 restore_logo
else
 echo "=========================================="
 echo "  Ubuntu Login Logo Remover (Zero-to-Hero)"
 echo "=========================================="
 apply_patch
fi
